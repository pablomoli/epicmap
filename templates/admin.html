<!doctype html>
<html>
  <head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <style>
      /* Consistent styling with admin_jobs.html */
      .action-btn {
        margin: 2px;
        padding: 5px 10px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
      }
      
      .edit-btn {
        background-color: #4caf50;
        color: white;
      }
      
      .delete-btn {
        background-color: #f44336;
        color: white;
      }
      
      .toggle-btn {
        background-color: #2196f3;
        color: white;
      }
      
      .user-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      
      .user-table th, .user-table td {
        padding: 8px;
        text-align: left;
        border: 1px solid #ddd;
      }
      
      .user-table tr:nth-child(even) {
        background-color: #f2f2f2;
      }
      
      .user-table tr:hover {
        background-color: #ddd;
      }
      
      .user-form {
        max-width: 500px;
        padding: 20px;
        background-color: #f5f5f5;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      
      .user-form input[type="text"],
      .user-form input[type="password"],
      .user-form select {
        width: 100%;
        padding: 8px;
        margin: 5px 0 15px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }
      
      .user-form button {
        background-color: #4caf50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      
      .user-form button:hover {
        background-color: #45a049;
      }
      
      .inline-form {
        display: inline-block;
        margin-right: 5px;
      }
      
      .navigation {
        display: flex;
        gap: 20px;
        margin: 10px 0 20px 0;
      }
      
      .navigation a {
        text-decoration: none;
        padding: 8px 15px;
        background-color: #2196f3;
        color: white;
        border-radius: 4px;
      }
      
      .navigation a:hover {
        background-color: #0b7dda;
      }
    </style>
  </head>
  <body>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul style="color: green; font-weight: bold;">
          {% for msg in messages %}
            <li>{{ msg }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    
    <h1>Admin Dashboard</h1>
    
    <div class="navigation">
      <a href="/admin/jobs">Manage Jobs</a>
      <a href="/admin/users">Manage Users</a>
      <a href="/">Back to Main Site</a>
    </div>
    
    <h2>User List</h2>
    <table class="user-table">
      <thead>
        <tr>
          <th>Username</th>
          <th>Name</th>
          <th>Role</th>
          <th>Last Login</th>
          <th>Reset Password</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.name }}</td>
          <td>{{ user.role }}</td>
          <td>{{ user.last_login or 'Never' }}</td>
          <td>
            <form method="POST" action="/admin/reset_password/{{ user.id }}" class="inline-form">
              <input type="password" name="new_password" placeholder="New password" required />
              <button type="submit" class="action-btn edit-btn">Reset</button>
            </form>
          </td>
          <td>
            <form method="POST" action="/admin/delete_user/{{ user.id }}" class="inline-form">
              <button type="submit" class="action-btn delete-btn" onclick="return confirm('Are you sure you want to delete user {{ user.username }}?')">Delete</button>
            </form>
            <form method="POST" action="/admin/toggle_role/{{ user.id }}" class="inline-form">
              <button type="submit" class="action-btn toggle-btn">Make {{ 'Admin' if user.role == 'user' else 'User' }}</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    
    <h2>Create New User</h2>
    <form method="POST" action="/admin/create_user" class="user-form" autocomplete="off">
      <!-- Hidden fields to prevent autocomplete -->
      <input type="text" id="prevent_autofill" name="prevent_autofill" style="display:none;" />
      <input type="password" id="password_fake" name="password_fake" style="display:none;" />
      
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required autocomplete="off" />
      
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required autocomplete="new-username" />
      
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required autocomplete="new-password" />
      
      <label for="role">Role:</label>
      <select id="role" name="role" required>
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      
      <button type="submit">Create User</button>
    </form>
    
    <script>
      // Additional protection against autofill
      window.onload = function() {
        // Small delay to ensure browser has loaded
        setTimeout(function() {
          document.getElementById('name').value = '';
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
        }, 100);
      };
    </script>
  </body>
</html>
